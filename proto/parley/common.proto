syntax = "proto3";

package parley.v1;

import "google/protobuf/timestamp.proto";

// === Common types used across Parley ===

// JWKS-based issuer identity: we reveal issuer identity for royalty accounting.
message IssuerKeyHash {
  // BLAKE2s-256( "zerokp.issuer.vk.v1" || issuer_rj_vk_bytes )
  bytes value = 1; // 32 bytes
}

// A compact, schema-tagged credential message committed to within the SNARK.
message CredMsg {
  uint32 v      = 1; // credential format version (binds into the RedJubjub prehash)
  string kid    = 2; // issuer key id (from JWKS)
  bytes  c      = 3; // 32-byte Jubjub Pedersen commitment to DOB
  uint64 iat    = 4; // issued-at (seconds since Unix epoch)
  uint64 exp    = 5; // expiry (seconds since Unix epoch)
  string schema = 6; // e.g. "dob-v1"
}

// A RedJubjub signature over BLAKE2s(cred preimage). Signature bytes are not revealed in proofs.
message RedJubjubSignature {
  bytes sig = 1; // 64 bytes
}

// Convenience envelope returned by issuer APIs.
message SignedCredential {
  CredMsg            msg   = 1;
  RedJubjubSignature sig   = 2;
  // Optional convenience copy of the public key bytes (32 bytes) for clients that want to cache.
  bytes              issuer_vk = 3;
}